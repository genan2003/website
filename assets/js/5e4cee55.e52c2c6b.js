"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6262],{95541:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>o,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"lab/05/index","title":"05 - Serial Peripheral Interface","description":"Serial Peripheral Interface","source":"@site/versioned_docs/version-acs_cc/lab/05/index.mdx","sourceDirName":"lab/05","slug":"/lab/05","permalink":"/docs/acs_cc/lab/05","draft":false,"unlisted":false,"editUrl":"https://www.github.com/upb-pmrust/website/edit/main/website/lab/05/index.mdx","tags":[],"version":"acs_cc","frontMatter":{"description":"Serial Peripheral Interface","slug":"/lab/05"},"sidebar":"tutorialSidebar","previous":{"title":"04 - Asynchronous Development","permalink":"/docs/acs_cc/lab/04"},"next":{"title":"06 - Inter-Integrated Circuit","permalink":"/docs/acs_cc/lab/06"}}');var t=n(74848),r=n(28453);const a={description:"Serial Peripheral Interface",slug:"/lab/05"},l="05 - Serial Peripheral Interface",d={},c=[{value:"Resources",id:"resources",level:2},{value:"Serial Peripheral Interface (SPI)",id:"serial-peripheral-interface-spi",level:2},{value:"Data transmission",id:"data-transmission",level:3},{value:"Transmission example",id:"transmission-example",level:4},{value:"SPI modes",id:"spi-modes",level:3},{value:"Daisy Chaining",id:"daisy-chaining",level:3},{value:"DMA",id:"dma",level:2},{value:"SPI in Embassy",id:"spi-in-embassy",level:2},{value:"Digital vs Analog sensors",id:"digital-vs-analog-sensors",level:2},{value:"Analog sensors",id:"analog-sensors",level:3},{value:"Digital sensors",id:"digital-sensors",level:3},{value:"MPU-6500 Inertial Measurement Unit",id:"mpu-6500-inertial-measurement-unit",level:2},{value:"MPU-6500 Memory Map",id:"mpu-6500-memory-map",level:3},{value:"Registers",id:"registers",level:4},{value:"MPU-6500 wiring",id:"mpu-6500-wiring",level:3},{value:"Reading data from the MPU-6500 sensor using Embassy",id:"reading-data-from-the-mpu-6500-sensor-using-embassy",level:3},{value:"Reading a register",id:"reading-a-register",level:4},{value:"Writing to a register",id:"writing-to-a-register",level:4},{value:"Screen",id:"screen",level:2},{value:"ST7735 TFT Screen Controller",id:"st7735-tft-screen-controller",level:3},{value:"Embedded Graphics",id:"embedded-graphics",level:3},{value:"Exercises",id:"exercises",level:2}];function h(e){const s={a:"a",admonition:"admonition",annotation:"annotation",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"05---serial-peripheral-interface",children:"05 - Serial Peripheral Interface"})}),"\n",(0,t.jsx)(s.p,{children:"This lab will teach you how to communicate with hardware devices using the Serial Peripheral Interface (SPI) protocol, in Embassy."}),"\n",(0,t.jsx)(s.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Raspberry Pi Ltd"}),", ",(0,t.jsx)(s.em,{children:(0,t.jsx)(s.a,{href:"https://datasheets.raspberrypi.com/rp2350/rp2350-datasheet.pdf",children:"RP2350 Datasheet"})})]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Chapter 12 - ",(0,t.jsx)(s.em,{children:"Peripherals"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Chapter 12.3 - ",(0,t.jsx)(s.em,{children:"SPI"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Invensense"}),", ",(0,t.jsx)(s.em,{children:(0,t.jsx)(s.a,{href:"https://invensense.tdk.com/products/motion-tracking/6-axis/mpu-6500/#documentation",children:"MPU-6500 Six-Axis (Gyro + Accelerometer) MEMS MotionTracking\u2122 Device"})})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Paul Denisowski"}),", ",(0,t.jsx)(s.em,{children:(0,t.jsx)(s.a,{href:"https://www.youtube.com/watch?v=0nVNwozXsIc",children:"Understanding SPI"})})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"serial-peripheral-interface-spi",children:"Serial Peripheral Interface (SPI)"}),"\n",(0,t.jsxs)(s.p,{children:["The Serial Peripheral Interface (or SPI) is a communication protocol used between microcontrollers and peripheral ICs (integrated circuits). It allows synchronous transfer of data between one ",(0,t.jsx)(s.em,{children:"main"})," device and one or more ",(0,t.jsx)(s.em,{children:"sub"})," devices (e.g. sensors). The main device is the one that dictates the communication."]}),"\n",(0,t.jsx)(s.h3,{id:"data-transmission",children:"Data transmission"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"SPI_protocol",src:n(20753).A+"",width:"691",height:"259"})}),"\n",(0,t.jsx)(s.p,{children:"SPI transmission usually uses 4 lines:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"CLK"})," - clock - generated by the main device - subs use it to synchronously read and write to the bus"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"MOSI"})," - ",(0,t.jsx)(s.strong,{children:"M"}),"ain ",(0,t.jsx)(s.strong,{children:"O"}),"ut ",(0,t.jsx)(s.strong,{children:"S"}),"ub ",(0,t.jsx)(s.strong,{children:"I"}),"n - used to carry data from the main device to ",(0,t.jsx)(s.em,{children:"all"})," the subs"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"MISO"})," - ",(0,t.jsx)(s.strong,{children:"M"}),"ain ",(0,t.jsx)(s.strong,{children:"I"}),"n ",(0,t.jsx)(s.strong,{children:"S"}),"ub ",(0,t.jsx)(s.strong,{children:"O"}),"ut - used to carry data from the ",(0,t.jsx)(s.em,{children:"active"})," sub to the main device"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"CS"})," - chip select - selects the sub to be activated, or the sub that the main wants to communicate with","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"one wire per sub"}),"\n",(0,t.jsxs)(s.li,{children:["inactive subs will disconnect from the ",(0,t.jsx)(s.em,{children:"MOSI"})," and ",(0,t.jsx)(s.em,{children:"MISO"})," lines"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["The communication is ",(0,t.jsx)(s.em,{children:"full-duplex"}),". This means that data is transmitted in both directions simultaneously. With that being said, during data transmission, both the main and the sub ",(0,t.jsx)(s.strong,{children:"must write"})," to the MOSI/MISO wires, no matter if that data is relevant or not."]})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["SPI is most commonly implemented in a 4-wire configuration. However, there is also a 3-wire configuration, where the ",(0,t.jsx)(s.code,{children:"MOSI"})," and ",(0,t.jsx)(s.code,{children:"MISO"})," lines are common. This makes the communication ",(0,t.jsx)(s.em,{children:"half-duplex"}),", since data can be sent only in one direction at a time."]})}),"\n",(0,t.jsx)(s.h4,{id:"transmission-example",children:"Transmission example"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["main sets ",(0,t.jsx)(s.code,{children:"CS"})," to ",(0,t.jsx)(s.code,{children:"LOW"})," - the sub that the main wants to communicate with is activated - all other subs are already disconnected from ",(0,t.jsx)(s.code,{children:"MOSI"})," and ",(0,t.jsx)(s.code,{children:"MISO"})," lines as their CS line is not active"]}),"\n",(0,t.jsxs)(s.li,{children:["main writes the first bit on the ",(0,t.jsx)(s.code,{children:"MOSI"})," line, and, ",(0,t.jsx)(s.em,{children:"simultaneously"}),", sub writes the first bit on the ",(0,t.jsx)(s.code,{children:"MISO"})," line"]}),"\n",(0,t.jsx)(s.li,{children:"main starts the clock"}),"\n",(0,t.jsxs)(s.li,{children:["on ",(0,t.jsx)(s.em,{children:"rising edge"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["main reads data from the ",(0,t.jsx)(s.code,{children:"MISO"})," line"]}),"\n",(0,t.jsxs)(s.li,{children:["sub reads data from the ",(0,t.jsx)(s.code,{children:"MOSI"})," line"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["on ",(0,t.jsx)(s.em,{children:"falling edge"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["main writes data to the ",(0,t.jsx)(s.code,{children:"MOSI"})," line"]}),"\n",(0,t.jsxs)(s.li,{children:["sub writes data to the ",(0,t.jsx)(s.code,{children:"MISO"})," line"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"repeat steps 4 and 5 until main stops the clock"}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["Whether steps 4 and 5 happen on rising/falling edge depends on the ",(0,t.jsx)(s.code,{children:"CPOL"})," configuration of the SPI."]})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"SPI_example",src:n(29048).A+"",width:"1000",height:"210"})}),"\n",(0,t.jsxs)(s.p,{children:["In the image above, the main first exchanges data with the first sub by setting its corresponding ",(0,t.jsx)(s.code,{children:"CS"})," line to low. After it finishes transmission with sub 1, it deactivates it and, afterwards, initiates communication with the second sub by setting its ",(0,t.jsx)(s.code,{children:"CS"})," line to low. Notice that both main and sub read and write to the MOSI/MISO line simultaneously."]}),"\n",(0,t.jsx)(s.h3,{id:"spi-modes",children:"SPI modes"}),"\n",(0,t.jsxs)(s.p,{children:["SPI has 4 different modes which define when data is read or written. These modes can be configured through ",(0,t.jsx)(s.code,{children:"CPOL"})," and ",(0,t.jsx)(s.code,{children:"CPHA"})," by changing the ",(0,t.jsx)(s.code,{children:"SPO"})," and ",(0,t.jsx)(s.code,{children:"SPH"})," bits of the ",(0,t.jsx)(s.a,{href:"https://datasheets.raspberrypi.com/rp2350/rp2350-datasheet.pdf#reg-spi-SSPCR0",children:(0,t.jsx)(s.code,{children:"SSPCR0"})})," register."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Mode"}),(0,t.jsx)(s.th,{children:(0,t.jsx)(s.code,{children:"CPOL"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)(s.code,{children:"CPHA"})}),(0,t.jsx)(s.th,{children:"Clock polarity in idle state"}),(0,t.jsx)(s.th,{children:"Clock phase used to read and/or write data"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"Logic Low"}),(0,t.jsx)(s.td,{children:"Data read on rising edge and written on falling edge"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"Logic low"}),(0,t.jsx)(s.td,{children:"Data read on the falling edge and written on the rising edge"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"2"}),(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"Logic high"}),(0,t.jsx)(s.td,{children:"Data read on the falling edge and written on the rising edge"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3"}),(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"Logic high"}),(0,t.jsx)(s.td,{children:"Data read on the rising edge and written on the falling edge"})]})]})]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{}),(0,t.jsx)(s.th,{}),(0,t.jsx)(s.th,{})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"CPOL"})}),(0,t.jsx)(s.td,{children:"Clock polarity"}),(0,t.jsxs)(s.td,{children:["defines when the clock is considered ",(0,t.jsx)(s.em,{children:"idle"}),", or when no transfer is occurring"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"CPHA"})}),(0,t.jsx)(s.td,{children:"Clock phase"}),(0,t.jsxs)(s.td,{children:["defines when the data bit is read and when it is written: depends on ",(0,t.jsx)(s.code,{children:"CPOL"})]})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"SPI_timing_diagram",src:n(92647).A+"",width:"590",height:"270"})}),"\n",(0,t.jsx)(s.h3,{id:"daisy-chaining",children:"Daisy Chaining"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Daisy chaining"})," is an SPI configuration through which the sub devices are linked together as such:"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"SPI_Daisy",src:n(79469).A+"",width:"691",height:"249"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"MOSI"})," line connects the main device only to the first sub. Then, the ",(0,t.jsx)(s.code,{children:"MISO"})," output of the first sub ties to the ",(0,t.jsx)(s.code,{children:"MOSI"})," input of the second sub, and so forth. The final sub in the chain ties to the ",(0,t.jsx)(s.code,{children:"MISO"})," line of the main device. All ",(0,t.jsx)(s.code,{children:"CS"})," lines are common, therefore all subs are active concurrently."]}),"\n",(0,t.jsx)(s.p,{children:"For example, if main wants to communicate with the second sub, it will:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["send its data through the ",(0,t.jsx)(s.code,{children:"MOSI"})," line to the first sub"]}),"\n",(0,t.jsx)(s.li,{children:"the first sub will send the data to the second sub, through the common wire"}),"\n",(0,t.jsx)(s.li,{children:"once the second sub receives the data, it will send its response to the third sub"}),"\n",(0,t.jsxs)(s.li,{children:["at the end of the chain, the last sub will send the data back to the main device through the ",(0,t.jsx)(s.code,{children:"MISO"})," line"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"dma",children:"DMA"}),"\n",(0,t.jsxs)(s.p,{children:["When it comes to standard communication protocols that rely on ",(0,t.jsx)(s.a,{href:"../lecture/02",children:"MMIO"}),", it would be inefficient to rely on the MCU itself to handle all of these data transfers. This is why the ",(0,t.jsx)(s.strong,{children:"Direct Memory Access"})," (DMA) is used. Its purpose is to offload the MCU by dealing with simple transmission to and from peripherals, and whenever it finishes a transfer, it raises an interrupt."]}),"\n",(0,t.jsx)(s.h2,{id:"spi-in-embassy",children:"SPI in Embassy"}),"\n",(0,t.jsx)(s.p,{children:"In Embassy, we can use the SPI both blocking and asynchronously. The following example will be using the asynchronous version."}),"\n",(0,t.jsx)(s.admonition,{type:"warning",children:(0,t.jsxs)(s.p,{children:["The SPI can also be used synchronously, but this means that for every transfer, the thread will be blocked, as we found out in the ",(0,t.jsx)(s.a,{href:"./04",children:"previous lab"}),"."]})}),"\n",(0,t.jsx)(s.p,{children:"First, we initialize the peripherals."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let p = embassy_rp::init(Default::default());\n"})}),"\n",(0,t.jsx)(s.p,{children:"Next, we create the configuration for the SPI. We can set the clock frequency, polarity and phase (the SPI mode)."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let mut config = spi::Config::default();\nconfig.frequency = 1_000_000;\nconfig.phase = spi::Phase::CaptureOnFirstTransition;\nconfig.polarity = spi::Polarity::IdleLow;\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Once we have the configuration, we can initialize the ",(0,t.jsx)(s.code,{children:"MISO"}),", ",(0,t.jsx)(s.code,{children:"MOSI"})," and ",(0,t.jsx)(s.code,{children:"CLK"})," pins."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let miso = p.PIN_X;\nlet mosi = p.PIN_Y;\nlet clk = p.PIN_Z;\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Now we can create our SPI instance. The example uses the SPI0 channel, but others can be used. Being an asynchronous SPI, it also needs a pair of ",(0,t.jsx)(s.code,{children:"DMA"})," channels, one that handles the ",(0,t.jsx)(s.em,{children:"transmission"})," of data, and one that handles the ",(0,t.jsx)(s.em,{children:"receiving"})," of data."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let mut spi = Spi::new(p.SPI0, clk, mosi, miso, p.DMA_CH0, p.DMA_CH1, config);\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["To figure out which pins work with SPI and what channels they are associated with, you need to take a look at the ",(0,t.jsx)(s.a,{href:"./05#mpu-6500-wiring",children:"pinout"})," of the Raspberry Pi Pico and the ",(0,t.jsx)(s.a,{href:"https://gitlab.cs.pub.ro/pmrust/pm-ma-pcb/-/blob/main/Schematic/MA.pdf",children:"lab board schematic"}),"."]})}),"\n",(0,t.jsxs)(s.p,{children:["We also need a ",(0,t.jsx)(s.code,{children:"CS"})," pin, that is simply a GPIO output pin. We will initialize it as such. Any pin can be used. For multiple subs, multiple pins will be initialized."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let mut cs = Output::new(p.PIN_N, Level::High);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Now we have set up the SPI, and can use it to communicate with the connected sub. To activate the sub, we need to set the ",(0,t.jsx)(s.code,{children:"cs"})," pin to ",(0,t.jsx)(s.code,{children:"low"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"cs.set_low();\n"})}),"\n",(0,t.jsx)(s.p,{children:"Once we do this, we can use two buffers:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"tx_buf"})," - used to store data to transmit to the sub via the ",(0,t.jsx)(s.code,{children:"MOSI"})," line"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"rx_buf"})," - one to store data to receive from the sub via the ",(0,t.jsx)(s.code,{children:"MISO"})," line"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let tx_buf = [1_u8, 2, 3, 4, 5, 6];\nlet mut rx_buf = [0_u8; 6]; // dummy values, will be replaced by received data\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"rx_buf"})," is mutable because the values inside the buffer will be replaced by the data received from the sub."]})}),"\n",(0,t.jsxs)(s.p,{children:["We then use the two buffers to make the transfer. The values in ",(0,t.jsx)(s.code,{children:"tx_buffer"})," will be sent over the ",(0,t.jsx)(s.code,{children:"MOSI"})," and the values received over the ",(0,t.jsx)(s.code,{children:"MISO"})," will be stored in ",(0,t.jsx)(s.code,{children:"rx_buf"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"spi.transfer(&mut rx_buf, &tx_buf).await;\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Once we are done with the transfer, we set the ",(0,t.jsx)(s.code,{children:"cs"})," line back to ",(0,t.jsx)(s.code,{children:"high"})," to deactivate the sub."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"cs.set_high();\n"})}),"\n",(0,t.jsx)(s.h2,{id:"digital-vs-analog-sensors",children:"Digital vs Analog sensors"}),"\n",(0,t.jsx)(s.h3,{id:"analog-sensors",children:"Analog sensors"}),"\n",(0,t.jsxs)(s.p,{children:["Up to now, during the labs, we have been using ",(0,t.jsx)(s.em,{children:"analog sensors"})," (photoresistor and potentiometer). Analog sensors are just a transducer, which outputs a voltage depending on its measurement (light, temperature, etc.). This output needs to be read using an ADC and processed so that it can resemble something useful to us."]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsx)(s.p,{children:"For example, for an analog temperature sensor, we would be getting a voltage reading that we need to convert to an actual temperature in Celsius by using a specific formula. This formula can usually be found in the datasheet of the analog sensor."})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Analog_Sensor",src:n(70745).A+"",width:"169",height:"96"})}),"\n",(0,t.jsx)(s.h3,{id:"digital-sensors",children:"Digital sensors"}),"\n",(0,t.jsxs)(s.p,{children:["For this lab, we will be using a ",(0,t.jsx)(s.em,{children:"digital sensor"}),", which is an ",(0,t.jsx)(s.em,{children:"upgraded"})," version of an analog sensor. It contains a transducer, but also an internal MCU with an ADC. This means that the sensor itself deals with the analog-to-digital conversion and the processing of the voltage reading, and exposes it through a digital interface of registers that can be accessed using a specific communication protocol (e.g. SPI, I2C etc.)."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Digital_Sensor",src:n(92065).A+"",width:"401",height:"112"})}),"\n",(0,t.jsx)(s.h2,{id:"mpu-6500-inertial-measurement-unit",children:"MPU-6500 Inertial Measurement Unit"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"MPU-6500"})," is a ",(0,t.jsx)(s.em,{children:"digital"})," gyroscope and accelerometer designed by InvenSense. It can be interfaced both with SPI and with I2C. This means that we can read the acceleration and angular velocity values directly from the registers of the MPU-6500 using SPI."]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://invensense.tdk.com/wp-content/uploads/2020/06/PS-MPU-6500A-01-v1.3.pdf",children:"DATASHEET"})}),": Describes the chip and its capabilities. ",(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"https://invensense.tdk.com/wp-content/uploads/2015/02/MPU-6500-Register-Map2.pdf",children:"REGISTER MAP"})}),": Describes how to configure and get values from the sensor."]})}),"\n",(0,t.jsx)(s.h3,{id:"mpu-6500-memory-map",children:"MPU-6500 Memory Map"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"address (HEX)"}),(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Access"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1B"}),(0,t.jsx)(s.td,{children:"GYRO_CONFIG"}),(0,t.jsx)(s.td,{children:"R/W"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1C"}),(0,t.jsx)(s.td,{children:"ACCEL_CONFIG"}),(0,t.jsx)(s.td,{children:"R/W"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"..."}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3B"}),(0,t.jsx)(s.td,{children:"ACCEL_XOUT_H"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3C"}),(0,t.jsx)(s.td,{children:"ACCEL_XOUT_L"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3D"}),(0,t.jsx)(s.td,{children:"ACCEL_YOUT_H"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3E"}),(0,t.jsx)(s.td,{children:"ACCEL_YOUT_L"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3F"}),(0,t.jsx)(s.td,{children:"ACCEL_ZOUT_H"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"40"}),(0,t.jsx)(s.td,{children:"ACCEL_ZOUT_L"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"..."}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"43"}),(0,t.jsx)(s.td,{children:"GYRO_XOUT_H"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"44"}),(0,t.jsx)(s.td,{children:"GYRO_XOUT_L"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"45"}),(0,t.jsx)(s.td,{children:"GYRO_YOUT_H"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"46"}),(0,t.jsx)(s.td,{children:"GYRO_YOUT_L"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"47"}),(0,t.jsx)(s.td,{children:"GYRO_ZOUT_H"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"48"}),(0,t.jsx)(s.td,{children:"GYRO_ZOUT_L"}),(0,t.jsx)(s.td,{children:"R"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"..."}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"75"}),(0,t.jsx)(s.td,{children:"WHO_AM_I"}),(0,t.jsx)(s.td,{children:"R"})]})]})]}),"\n",(0,t.jsx)(s.h4,{id:"registers",children:"Registers"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"WHO_AM_I"})," register - contains the ID of the MPU-6500"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"GYRO_CONFIG"})," register - used for configuring the gyroscope"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.th,{children:[(0,t.jsx)(s.code,{children:"GYRO_CONFIG"})," bits"]}),(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[7]"}),(0,t.jsx)(s.td,{children:"XG_ST X"}),(0,t.jsx)(s.td,{children:"Gyro self-test"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[6]"}),(0,t.jsx)(s.td,{children:"YG_ST Y"}),(0,t.jsx)(s.td,{children:"Gyro self-test"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[5]"}),(0,t.jsx)(s.td,{children:"ZG_ST Z"}),(0,t.jsx)(s.td,{children:"Gyro self-test"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[4:3]"}),(0,t.jsx)(s.td,{children:"GYRO_FS_SEL[1:0]"}),(0,t.jsx)(s.td,{children:"Gyro Full Scale Select"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[2]"}),(0,t.jsx)(s.td,{children:"-"}),(0,t.jsx)(s.td,{children:"Reserved"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[1:0]"}),(0,t.jsx)(s.td,{children:"FCHOICE_B[1:0]"}),(0,t.jsx)(s.td,{children:"Low Pass Filter Bypass"})]})]})]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"GYRO_FS_SEL[1:0]"}),(0,t.jsx)(s.th,{children:"Gyro Full Scale"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"00"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"250"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb1250 \xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"250\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"01"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"500"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb1500 \xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"500\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"10"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"1000"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb11000 \xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"1000\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"11"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"2000"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb12000 \xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"2000\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]})})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"ACCEL_CONFIG"})," register - used for configuring the accelerometer"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsxs)(s.th,{children:[(0,t.jsx)(s.code,{children:"ACCEL_CONFIG"})," bits"]}),(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[7]"}),(0,t.jsx)(s.td,{children:"XA_ST X"}),(0,t.jsx)(s.td,{children:"Accel self-test"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[6]"}),(0,t.jsx)(s.td,{children:"YA_ST Y"}),(0,t.jsx)(s.td,{children:"Accel self-test"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[5]"}),(0,t.jsx)(s.td,{children:"ZA_ST Z"}),(0,t.jsx)(s.td,{children:"Accel self-test"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[4:3]"}),(0,t.jsx)(s.td,{children:"ACCEL_FS_SEL[1:0]"}),(0,t.jsx)(s.td,{children:"Accel Full Scale Select"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[2:0]"}),(0,t.jsx)(s.td,{children:"-"}),(0,t.jsx)(s.td,{children:"Reserved"})]})]})]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"ACCEL_FS_SEL[1:0]"}),(0,t.jsx)(s.th,{children:"Accel Full Scale"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"00"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"2"}),(0,t.jsx)(s.mi,{children:"g"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb12 g"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8389em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"2"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"01"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"4"}),(0,t.jsx)(s.mi,{children:"g"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb14 g"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8389em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"4"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"10"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"8"}),(0,t.jsx)(s.mi,{children:"g"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb18 g"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8389em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"8"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"11"}),(0,t.jsx)(s.td,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"16"}),(0,t.jsx)(s.mi,{children:"g"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb116 g"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8389em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"16"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]})})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"ACCEL"})," registers - ",(0,t.jsx)(s.code,{children:"ACCEL_XOUT_H"}),", ",(0,t.jsx)(s.code,{children:"ACCEL_XOUT_L"}),", ",(0,t.jsx)(s.code,{children:"ACCEL_YOUT_H"}),", ",(0,t.jsx)(s.code,{children:"ACCEL_YOUT_L"}),", ",(0,t.jsx)(s.code,{children:"ACCEL_ZOUT_H"}),", ",(0,t.jsx)(s.code,{children:"ACCEL_ZOUT_L"})," - contain the acceleration"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"GYRO"})," registers - ",(0,t.jsx)(s.code,{children:"GYRO_XOUT_H"}),", ",(0,t.jsx)(s.code,{children:"GYRO_XOUT_L"}),", ",(0,t.jsx)(s.code,{children:"GYRO_YOUT_H"}),", ",(0,t.jsx)(s.code,{children:"GYRO_YOUT_L"}),", ",(0,t.jsx)(s.code,{children:"GYRO_ZOUT_H"}),", ",(0,t.jsx)(s.code,{children:"GYRO_ZOUT_L"})," - contain the angular velocity"]}),"\n",(0,t.jsxs)(s.admonition,{type:"note",children:[(0,t.jsxs)(s.p,{children:["The values read from the sensor are 16-bit signed integers and must be interpreted according to the Full Scale selected. By default, they are both set to 0 (",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"250"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb1250 \xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"250\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]}),", ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"2"}),(0,t.jsx)(s.mi,{children:"g"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb12 g"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8389em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"2"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]}),")."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"g"})," represents the gravity of Earth and is equal to approximately ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mn,{children:"9.80665"}),(0,t.jsx)(s.mi,{children:"m"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsxs)(s.msup,{children:[(0,t.jsx)(s.mi,{children:"s"}),(0,t.jsx)(s.mn,{children:"2"})]})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"9.80665 m/s^2"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1.0641em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"9.80665"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"m"}),(0,t.jsx)(s.span,{className:"mord",children:"/"}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,t.jsx)(s.span,{className:"msupsub",children:(0,t.jsx)(s.span,{className:"vlist-t",children:(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.8141em"},children:(0,t.jsxs)(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(s.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})})]}),"."]})]}),"\n",(0,t.jsx)(s.h3,{id:"mpu-6500-wiring",children:"MPU-6500 wiring"}),"\n",(0,t.jsx)(s.p,{children:"The MPU-6500 has 5 pins:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Pin"}),(0,t.jsx)(s.th,{children:"Function"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"VCC"})}),(0,t.jsx)(s.td,{children:"power source (3V3)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"GND"})}),(0,t.jsx)(s.td,{children:"ground"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"SCL"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"CLK"})," line"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"SDA"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"MOSI"})," line"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"EDA"})}),(0,t.jsx)(s.td,{children:"external sensors data line"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ECL"})}),(0,t.jsx)(s.td,{children:"external sensors clock"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ADO"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"MISO"})," line"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"INT"})}),(0,t.jsx)(s.td,{children:"interrupt line"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"NCS"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"CS"})," line, active Low"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"FSYNC"})}),(0,t.jsx)(s.td,{children:"synchronizing with external sensors"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"mpu6500_wiring",src:n(2355).A+"",width:"457",height:"466"})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsx)(s.p,{children:"The MPU-6500 can also be interfaced through I2C, using the same pins but with different functions."})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsx)(s.p,{children:"The MPU-6500 can also act as an I2C master and communicate with external sensors. This functionality will be ignored."})}),"\n",(0,t.jsxs)(s.p,{children:["The Raspberry Pi Pico has two usable SPI channels: SPI0 and SPI1. Each channel has multiple sets of pins that can be used for ",(0,t.jsx)(s.code,{children:"CLK"}),", ",(0,t.jsx)(s.code,{children:"MOSI"})," and ",(0,t.jsx)(s.code,{children:"MISO"}),". They are marked with pink in the pinout diagram."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"pico_pinout",src:n(76314).A+"",width:"1063",height:"698"})}),"\n",(0,t.jsxs)(s.admonition,{type:"info",children:[(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"TX"})," = transmitter = ",(0,t.jsx)(s.code,{children:"MOSI"})]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"RX"})," = receiver = ",(0,t.jsx)(s.code,{children:"MISO"})]})]}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["It is recommended to use the pins connected to the dedicated J12 & J13 headers on the ",(0,t.jsx)(s.a,{href:"https://gitlab.cs.pub.ro/pmrust/pm-ma-pcb/-/blob/main/Schematic/MA.pdf",children:"lab board"})]})}),"\n",(0,t.jsx)(s.h3,{id:"reading-data-from-the-mpu-6500-sensor-using-embassy",children:"Reading data from the MPU-6500 sensor using Embassy"}),"\n",(0,t.jsxs)(s.p,{children:["To get the data we want from the digital sensor, we need to access its internal registers. The MPU-6500 has some rules when it comes to reading and writing to these registers, that must be extracted from the ",(0,t.jsx)(s.a,{href:"https://invensense.tdk.com/products/motion-tracking/6-axis/mpu-6500/#documentation",children:"datasheets"}),". Every sensor has different registers, and different ways of interfacing them, so reading the datasheet is usually required, especially when we don't have the leverage of using already existing libraries for these sensors."]}),"\n",(0,t.jsx)(s.p,{children:"First, we make sure our SPI is initialized correctly."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let p = embassy_rp::init(Default::default());\n\n// default values are fine\nlet mut config = spi::Config::default();\n\nlet miso = p.PIN_X;\nlet mosi = p.PIN_Y;\nlet clk = p.PIN_Z;\n\nlet mut spi = Spi::new(p.SPI0, clk, mosi, miso, p.DMA_CH0, p.DMA_CH1, config);\n\n// make sure to actually choose a pin\nlet mut cs = Output::new(p.PIN_N, Level::High);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["In section 6.5 of the ",(0,t.jsx)(s.a,{href:"https://invensense.tdk.com/wp-content/uploads/2020/06/PS-MPU-6500A-01-v1.3.pdf",children:"datasheet"}),", we get the information we need in order to read/write to a register of the MPU-6500."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"SPI_read_write_MPU6500",src:n(97848).A+"",width:"749",height:"359"})}),"\n",(0,t.jsxs)(s.p,{children:["To know what is expected from it, the sensor needs to receive a ",(0,t.jsx)(s.em,{children:"control byte"}),". This control byte contains the address of the register that we want to access, except the 7th bit of this address is changed:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["it will be ",(0,t.jsx)(s.code,{children:"1"})," if we want to ",(0,t.jsx)(s.em,{children:"read"})," the register"]}),"\n",(0,t.jsxs)(s.li,{children:["it will be ",(0,t.jsx)(s.code,{children:"0"})," if we want to ",(0,t.jsx)(s.em,{children:"write"})," to the register"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["So, for example, if we wanted to read the register at address 0x1, we would need to send a control byte of ",(0,t.jsx)(s.code,{children:"10000001"}),", and if we wanted to write to it, we would send ",(0,t.jsx)(s.code,{children:"00000001"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"This way, we're sending a command to the sensor for it to know what to do: either send back the value of the register we requested or write to this register."}),"\n",(0,t.jsx)(s.h4,{id:"reading-a-register",children:"Reading a register"}),"\n",(0,t.jsxs)(s.p,{children:["To read the value of a register, the main device (the RP2350) needs to first send a control byte containing the address of that register, with the 7th bit a ",(0,t.jsx)(s.code,{children:"1"}),".\nThe sub device (the sensor) will then send a byte back, containing the value of the requested register."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"cs.set_low();\nlet tx_buf = [(1 << 7) | REG_ADDR, 0x00]; // first value of buffer is the control byte, second is a *don't care* value\nlet mut rx_buf = [0u8; 2]; // initial values that will be replaced by the received bytes\nspi.transfer(&mut rx_buf, &tx_buf).await.unwrap();\ncs.set_high();\nlet register_value = rx_buf[1]; // the second byte in the buffer will be the received register value\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["Remember, SPI is full-duplex. When the main writes, the sub also writes, no matter if it has any relevant data to send or not. This is why the ",(0,t.jsx)(s.code,{children:"tx_buf"})," and ",(0,t.jsx)(s.code,{children:"rx_buf"})," both have 2 elements. First, the main will send the register address (",(0,t.jsx)(s.code,{children:"tx_buf[0]"}),") and the sub will send a dummy value back (stored in ",(0,t.jsx)(s.code,{children:"rx_buf[0]"}),"), ",(0,t.jsx)(s.em,{children:"at the same time"}),". Then, the main will send a dummy value (",(0,t.jsx)(s.code,{children:"tx_buf[1]"}),") and the sub will send the value of the register (stored in ",(0,t.jsx)(s.code,{children:"rx_buf[1]"}),")."]})}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsxs)(s.p,{children:["Once we send the address of a register we want to read, the sensor will continuously send back bytes containing the values of the consecutive registers. For example, if we ask to read ",(0,t.jsx)(s.code,{children:"REG_ADDR"}),", the sensor will first send the register value at address ",(0,t.jsx)(s.code,{children:"REG_ADDR"}),", then the value at address ",(0,t.jsx)(s.code,{children:"REG_ADDR+1"}),", and so on, until we deactivate it."]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"cs.set_low();\nlet tx_buf = [(1 << 7) | REG_ADDR, 0x00, 0x00];\nlet mut rx_buf = [0u8; 3]; // three receive values instead of two\nspi.transfer(&mut rx_buf, &tx_buf).await.unwrap();\ncs.set_high();\nlet register_value = rx_buf[1]; // the second byte in the buffer will be the received register value (REG_ADDR)\nlet register_value_next = rx_buf[2]; // the third byte in the buffer will be the next received register value (REG_ADDR+1)\n"})}),(0,t.jsx)(s.p,{children:"This is explained in section 6.5 of the datasheet."})]}),"\n",(0,t.jsx)(s.h4,{id:"writing-to-a-register",children:"Writing to a register"}),"\n",(0,t.jsxs)(s.p,{children:["To write a value to a register, the main device (the RP2350) needs to first send a control byte containing the address of that register, with the 7th bit a ",(0,t.jsx)(s.code,{children:"0"}),".\nThe main device then must send the value that it wants to write to that register."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"cs.set_low();\nlet tx_buf = [!(1 << 7) & REG_ADDR, value_to_write]; // value_to_write is to be replaced with the 8-bit value that we want to write to this register\nlet mut rx_buf = [0u8; 2]; // we are not expecting any relevant information to be received, but we still need to receive dummy values anyway\nspi.transfer(&mut rx_buf, &tx_buf).await;\n"})}),"\n",(0,t.jsx)(s.h2,{id:"screen",children:"Screen"}),"\n",(0,t.jsx)(s.h3,{id:"st7735-tft-screen-controller",children:"ST7735 TFT Screen Controller"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.strong,{children:"ST7735"})," features a ",(0,t.jsx)(s.strong,{children:"128x160"})," screen and an integrated ",(0,t.jsx)(s.strong,{children:"SD card reader"}),". For now, we will ignore the SD card reader and focus on the screen."]}),"\n",(0,t.jsxs)(s.p,{children:["Because writing an SPI driver for the ST7735 would be out of the scope of the lab, we will be using the one provided by the ",(0,t.jsx)(s.strong,{children:"mipidsi"})," crate."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"use embassy_embedded_hal::shared_bus::blocking::spi::SpiDevice;\nuse embassy_sync::blocking_mutex::{Mutex, raw::NoopRawMutex};\nuse embassy_time::Delay;\nuse display_interface_spi::SPIInterface;\nuse mipidsi::models::ST7735s;\nuse mipidsi::options::{Orientation, Rotation};\n\n\nlet mut screen_config = embassy_rp::spi::Config::default();\nscreen_config.frequency = 32_000_000u32;\nscreen_config.phase = embassy_rp::spi::Phase::CaptureOnSecondTransition;\nscreen_config.polarity = embassy_rp::spi::Polarity::IdleHigh;\n\nlet screen_rst = Output::new(p.PIN_X, Level::Low);\nlet screen_dc = Output::new(p.PIN_Y, Level::Low);\nlet screen_cs = Output::new(p.PIN_Z, Level::High);\n\nlet spi = Spi::new_blocking(p.SPI0, clk, mosi, miso, screen_config);\nlet spi_bus: Mutex<NoopRawMutex, _> = Mutex::new(RefCell::new(spi));\nlet display_spi = SpiDevice::new(&spi_bus, screen_cs);\n\nlet di = SPIInterface::new(display_spi, screen_dc);\nlet mut screen = mipidsi::Builder::new(ST7735s, di)\n    .reset_pin(screen_rst)\n    .orientation(Orientation::new().rotate(Rotation::Deg180))\n    .init(&mut Delay)\n    .unwrap();\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Make sure to wire the pins on ",(0,t.jsx)(s.strong,{children:"J9"})," according to the pins chosen in the code and the picture below."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"screen_wiring",src:n(45530).A+"",width:"523",height:"539"})}),"\n",(0,t.jsx)(s.h3,{id:"embedded-graphics",children:"Embedded Graphics"}),"\n",(0,t.jsxs)(s.p,{children:["Because ",(0,t.jsx)(s.strong,{children:"mipidsi"})," only provides a very primitive way to draw on the screen, by setting individual pixels, we will be using the ",(0,t.jsx)(s.strong,{children:"embedded_graphics"})," framework. This library enables us to do more complex things, such as rendering image files, drawing shapes and displaying text."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:'use embedded_graphics::{\n    mono_font::{MonoTextStyle, ascii::FONT_6X10},\n    pixelcolor::Rgb565,\n    prelude::*,\n    text::Text,\n};\n\nscreen.clear(Rgb565::BLACK).unwrap();\n\nlet style = MonoTextStyle::new(&FONT_6X10, Rgb565::WHITE);\nText::new("Hello!", Point::new(20, 20), style)\n    .draw(&mut screen)\n    .unwrap();\n'})}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Make sure to check out the ",(0,t.jsx)(s.a,{href:"https://docs.rs/embedded-graphics/latest/embedded_graphics/index.html",children:"documentation"}),"."]})}),"\n",(0,t.jsx)(s.h2,{id:"exercises",children:"Exercises"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Connect the MPU-6500 as described in the ",(0,t.jsx)(s.a,{href:"#mpu-6500-wiring",children:"wiring configuration"})," (",(0,t.jsx)(s.strong,{children:"1p"}),")"]}),"\n",(0,t.jsxs)(s.li,{children:["Read and create a debug log with the ",(0,t.jsx)(s.a,{href:"#mpu-6500-memory-map",children:"WHO_AM_I"})," register. Does the result match the ",(0,t.jsx)(s.a,{href:"https://invensense.tdk.com/wp-content/uploads/2015/02/MPU-6500-Register-Map2.pdf",children:"data sheet"}),"? (",(0,t.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Take a look at the ",(0,t.jsx)(s.a,{href:"#reading-data-from-the-mpu-6500-sensor-using-embassy",children:"Reading data from the MPU-6500 sensor using Embassy"})," section."]})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["Use the provided ",(0,t.jsx)(s.a,{href:"https://github.com/UPB-PMRust/lab-2025",children:"lab skeleton"})," as a base."]})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:"Get the acceleration and angular velocity readings from the sensor."}),"\n"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Configure the full scale as ",(0,t.jsx)(s.strong,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"2"}),(0,t.jsx)(s.mi,{children:"g"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb12 g"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8389em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"2"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]})})," for the acceleration and ",(0,t.jsx)(s.strong,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\xb1"}),(0,t.jsx)(s.mn,{children:"1000"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb11000 \xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb1"}),(0,t.jsx)(s.span,{className:"mord",children:"1000\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]})})," for the angular velocity (",(0,t.jsx)(s.strong,{children:"2p"}),")"]}),"\n",(0,t.jsxs)(s.li,{children:["Read the raw values for the X axis of the accelerometer and print them in a loop. (",(0,t.jsx)(s.strong,{children:"2p"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["To configure the full scale, just set the *",(0,t.jsx)(s.strong,{children:"_FS_SEL"})," bits and leave the rest as 0."]})}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsxs)(s.p,{children:["Both the acceleration and the angular velocity are measured over 3 axis, resulting in signed 16-bit ",(0,t.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Endianness",children:"big-endian"})," values. Each value is split into 2 registers: *_H and *_L."]}),(0,t.jsxs)(s.p,{children:["To compute the ",(0,t.jsx)(s.strong,{children:"RAW"})," values, we need to read both registers and reconstruct the 16-bit value, as such:"]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"val = i16::from_be_bytes([val_h, val_l]);\n"})})]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Read and print the rest of the values. (",(0,t.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(s.ol,{start:"4",children:["\n",(0,t.jsxs)(s.li,{children:["Print the actual value of the accelerations (in ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"m"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsxs)(s.msup,{children:[(0,t.jsx)(s.mi,{children:"s"}),(0,t.jsx)(s.mn,{children:"2"})]})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"m/s^2"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1.0641em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"m"}),(0,t.jsx)(s.span,{className:"mord",children:"/"}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"}),(0,t.jsx)(s.span,{className:"msupsub",children:(0,t.jsx)(s.span,{className:"vlist-t",children:(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.8141em"},children:(0,t.jsxs)(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(s.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})})]}),") and the angular velocities (in ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{mathvariant:"normal",children:"\xb0"}),(0,t.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,t.jsx)(s.mi,{children:"s"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\xb0/s"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\xb0/"}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"s"})]})})]}),") (",(0,t.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Make use of the values configured in the ",(0,t.jsx)(s.strong,{children:"full scale"})," fields."]})}),"\n",(0,t.jsxs)(s.ol,{start:"5",children:["\n",(0,t.jsxs)(s.li,{children:["Show the values on the screen. Use both the sensor and the screen on the same SPI channel. This means that the two devices will be subs in the same common configuration, and therefore will use the same CLK, MOSI and MISO pins, with separate CS. (",(0,t.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsxs)(s.p,{children:["For this, we will need to initialize the sensor to use the same SPI bus as the screen. For this, we can use an Embassy driver called ",(0,t.jsx)(s.code,{children:"SpiDevice"}),", which will allow us to connect both the screen and the sensor in the same SPI configuration! Since the screen ",(0,t.jsx)(s.a,{href:"#screen",children:"is already using a blocking SPI"}),", we will use it when creating our SPI sensor device, like this:"]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"// Import the Trait in order to be able to use imu_spi.transfer()\nuse embedded_hal_1::spi::SpiDevice as _;\n\nlet mut imu_spi = SpiDeviceWithConfig::new(&spi_bus, imu_cs, imu_config);\n// Note: you no longer need to manually set the chip select pin when using imu_spi.transfer()\n"})})]}),"\n",(0,t.jsxs)(s.admonition,{type:"note",children:[(0,t.jsxs)(s.p,{children:["The formatting machine for transforming floating point numbers into strings is much more complex than the integer one. Displaying the values in floating point format would increase the ",(0,t.jsx)(s.code,{children:".text"})," size by ",(0,t.jsx)(s.strong,{children:"over 15%"}),".",(0,t.jsx)(s.br,{}),"\n","Because of this, it is recommended to manually convert the values to fixed point integers when creating the buffer for the display, as such:"]}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:'let mut buf = heapless::String::<10>::new();\ncore::write!(&mut buf, "{}.{}", f32_value as u32, (f32_value * 1000f32) as u32 % 1000).unwrap();\n'})}),(0,t.jsxs)(s.p,{children:["You can write all values in the same buffer. Use ",(0,t.jsx)(s.code,{children:"\\n"})," in the format string to write on separate lines."]})]}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsx)(s.p,{children:"The video buffer does not automatically clear after each write. In order for the text to not overlap over time, clear the screen before drawing."})}),"\n",(0,t.jsxs)(s.ol,{start:"6",children:["\n",(0,t.jsxs)(s.li,{children:["Did you notice that, when resting the board on the table, the acceleration over the ",(0,t.jsx)(s.strong,{children:"z"})," axis indicates the acceleration caused by Earth's gravity? Using this fact, if kept still, you can determine the absolute ",(0,t.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Aircraft_principal_axes",children:"pitch and roll"})," of the sensor. Create a small game where a ball rolls on the screen depending on the tilt. (",(0,t.jsx)(s.strong,{children:"1p"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["You are ",(0,t.jsx)(s.strong,{children:"not"})," ",(0,t.jsx)(s.em,{children:"required"})," to simulate gravity and acceleration in the game. Moving the circle proportional to the tilt angle is enough."]})}),"\n",(0,t.jsxs)(s.admonition,{type:"tip",children:[(0,t.jsx)(s.p,{children:"Compute the pitch and roll as such:"}),(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-rust",children:"let pitch = f32::atan2(acc_y, f32::sqrt(acc_x * acc_x + acc_z * acc_z)).to_degrees();\nlet roll = f32::atan2(-acc_x, f32::sqrt(acc_y * acc_y + acc_z * acc_z)).to_degrees();\n"})}),(0,t.jsxs)(s.p,{children:["Make sure to add ",(0,t.jsx)(s.code,{children:'micromath = "2.1.0"'})," to the project ",(0,t.jsx)(s.code,{children:"Cargo.toml"})," dependencies."]})]}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsxs)(s.p,{children:["Check out the example for drawing a ",(0,t.jsx)(s.a,{href:"https://docs.rs/embedded-graphics/latest/embedded_graphics/primitives/circle/struct.Circle.html#examples",children:"circle"}),"."]})}),"\n",(0,t.jsxs)(s.admonition,{type:"note",children:[(0,t.jsx)(s.p,{children:"In order to increase the framerate, make sure to decrease the delay."}),(0,t.jsx)(s.p,{children:"Clearing the whole screen takes time. In order to optimize further, instead, draw a black circle over the old one before computing the new location."})]})]})}function o(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},70745:(e,s,n)=>{n.d(s,{A:()=>i});const i="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNjlweCIgaGVpZ2h0PSI5NnB4IiB2aWV3Qm94PSItMC41IC0wLjUgMTY5IDk2Ij48ZGVmcy8+PGc+PGcvPjxnPjxwYXRoIGQ9Ik0gMTAwIDQ3LjUgTCAxMzAgNDcuNSBMIDE1My42MyA0Ny41MSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNzNhM2E0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHBvaW50ZXItZXZlbnRzPSJzdHJva2UiLz48cGF0aCBkPSJNIDE1OC44OCA0Ny41MSBMIDE1MS44OCA1MS4wMSBMIDE1My42MyA0Ny41MSBMIDE1MS44OCA0NC4wMSBaIiBmaWxsPSIjNzNhM2E0IiBzdHJva2U9IiM3M2EzYTQiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjwvZz48Zz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogMXB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDMwcHg7IG1hcmdpbi1sZWZ0OiAxMzBweDsiPjxkaXYgc3R5bGU9ImJveC1zaXppbmc6IGJvcmRlci1ib3g7IGZvbnQtc2l6ZTogMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IiBkYXRhLWRyYXdpby1jb2xvcnM9ImNvbG9yOiByZ2IoMCwgMCwgMCk7IGJhY2tncm91bmQtY29sb3I6IHJnYigyNTUsIDI1NSwgMjU1KTsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTFweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6IHJnYigwLCAwLCAwKTsgbGluZS1oZWlnaHQ6IDEuMjsgcG9pbnRlci1ldmVudHM6IGFsbDsgYmFja2dyb3VuZC1jb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpOyB3aGl0ZS1zcGFjZTogbm93cmFwOyI+PGRpdj5Wb2x0YWdlwqA8L2Rpdj48ZGl2Pk91dHB1dDwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMzAiIHk9IjMzIiBmaWxsPSJyZ2IoMCwgMCwgMCkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTFweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Vm9sdGFnZS4uLjwvdGV4dD48L3N3aXRjaD48L2c+PC9nPjxnPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAiIGhlaWdodD0iOTUiIHJ4PSIxNC4yNSIgcnk9IjE0LjI1IiBmaWxsPSIjZjVmNWY1IiBzdHJva2U9IiM2NjY2NjYiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48L2c+PGc+PGltYWdlIHg9IjQuNSIgeT0iMiIgd2lkdGg9IjkwIiBoZWlnaHQ9IjkwIiB4bGluazpocmVmPSJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJR1pwYkd3OUltNXZibVVpSUhacFpYZENiM2c5SWpBZ01DQXlOQ0F5TkNJZ2FHVnBaMmgwUFNJNE1EQndlQ0lnZDJsa2RHZzlJamd3TUhCNElqNG1JM2hoT3p4d1lYUm9JSE4wY205clpTMXNhVzVsYW05cGJqMGljbTkxYm1RaUlITjBjbTlyWlMxc2FXNWxZMkZ3UFNKeWIzVnVaQ0lnYzNSeWIydGxMWGRwWkhSb1BTSXlJaUJ6ZEhKdmEyVTlJaU13TURBd01EQWlJR1E5SWswNExqUTJORFEzSURFMUxqVXpOVFZETmk0MU1URTROU0F4TXk0MU9ESTVJRFl1TlRFeE9EVWdNVEF1TkRFM01TQTRMalEyTkRRM0lEZ3VORFkwTkRkTk5TNDJNelU1TWlBeE9DNHpOalJETWk0eE1qRXlJREUwTGpnME9UTWdNaTR4TWpFeUlEa3VNVFV3TnpjZ05TNDJNelU1TWlBMUxqWXpOakExVFRFMUxqVXpOVFVnTVRVdU5UTTFOVU14Tnk0ME9EZ3hJREV6TGpVNE1qa2dNVGN1TkRnNE1TQXhNQzQwTVRjeElERTFMalV6TlRVZ09DNDBOalEwTjAweE9DNHpOalFnTVRndU16WTBRekl4TGpnM09EZ2dNVFF1T0RRNU15QXlNUzQ0TnpnNElEa3VNVFV3TnpjZ01UZ3VNelkwSURVdU5qTTJNRFZOTVRNZ01USXVNREF3TVVNeE15QXhNaTQxTlRJeklERXlMalUxTWpNZ01UTXVNREF3TVNBeE1pQXhNeTR3TURBeFF6RXhMalEwTnpjZ01UTXVNREF3TVNBeE1TQXhNaTQxTlRJeklERXhJREV5TGpBd01ERkRNVEVnTVRFdU5EUTNPQ0F4TVM0ME5EYzNJREV4TGpBd01ERWdNVElnTVRFdU1EQXdNVU14TWk0MU5USXpJREV4TGpBd01ERWdNVE1nTVRFdU5EUTNPQ0F4TXlBeE1pNHdNREF4V2lJdlBpWWplR0U3UEM5emRtYysiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiLz48L2c+PC9nPjxzd2l0Y2g+PGcgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ii8+PGEgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtNSkiIHhsaW5rOmhyZWY9Imh0dHBzOi8vd3d3LmRyYXdpby5jb20vZG9jL2ZhcS9zdmctZXhwb3J0LXRleHQtcHJvYmxlbXMiIHRhcmdldD0iX2JsYW5rIj48dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEwcHgiIHg9IjUwJSIgeT0iMTAwJSI+VGV4dCBpcyBub3QgU1ZHIC0gY2Fubm90IGRpc3BsYXk8L3RleHQ+PC9hPjwvc3dpdGNoPjwvc3ZnPg=="},92065:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/digital_sensor-091792696ba992aff298fd20483bc061.svg"},2355:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/mpu6500_wiring-51ee5e5ea82cb9f2da8024c9147f84ab.png"},76314:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/pico-2-r4-pinout-4a262aae81b983e83f2af5f598c6cd6e.png"},45530:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/screen_wiring-263d906c7cf7db69de8bd67337cee223.png"},79469:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/spi_daisy-5a73293643c13ccb3a7137871dd083cf.svg"},20753:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/spi_network-2dfbfa43885de34ead2d66cb1fe9efcf.svg"},29048:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/spi_network_transmission-0ac8016c74bf24a77c7d7cb6097fe868.svg"},97848:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/spi_read_write_mpu6500-219548336d75daa90508501036c91611.png"},92647:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/spi_variants-7a5d3abadeee766cae32471c6b2d50b3.svg"},28453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>l});var i=n(96540);const t={},r=i.createContext(t);function a(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);